<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>NGEN</title>

		<link rel="stylesheet" href="app.style.css" type="text/css" charset="utf-8"/>
		
	    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
		<script src="http://code.jquery.com/ui/1.8.23/jquery-ui.min.js"></script>

		<script type="text/javascript" src="app.base.js"></script>
		<script type="text/javascript" src="app.math.js"></script>
		<script type="text/javascript" src="app.hid.js"></script>
		<script type="text/javascript" src="app.renderer.js"></script>
		<script type="text/javascript" src="app.entities.js"></script>
		<script type="text/javascript" src="app.scheduler.js"></script>
		<script type="text/javascript" src="app.world.js"></script>
		<script type="text/javascript" src="app.springlayout.js"></script>
		<script type="text/javascript" src="app.details.js"></script>
		<script type="text/javascript" src="app.search.js"></script>
		<script type="text/javascript" src="app.filter.js"></script>
		<script type="text/javascript" src="app.runtime.js"></script>

		<script>
		
		var g = {
	        
	        companies : [
	        
	            {
	            	label: 'Center',
	                id : 1,
	                type : 1,
	                outsources : [{id : 2, weight : 1}, {id : 5, weight : 1}],
	                fixed: [0,0]
	            },
	            
	            {
	                id : 2,
	                type : 1,
	                label: 'Right of center',
	                fixed: [1, 0]
	            },

	            {
	                id : 3,
	                type : 1,
	                outsources : [{id : 4, weight : 1}, {id : 1, weight : 1}]
	            },

	            {
	                id : 4,
	                type : 2
	            },

	            {
	                id : 5,
	                type : 2
	            },

	            {
	                id : 6,
	                type : 1
	            },
	            
	            {
	                id : 7,
	                type : 2
	            },

	            {
	                id : 8,
	                type : 2
	            },

	            {
	                id : 9,
	                type : 1,
	                outsources : [{id : 8, weight : 1.2}, {id : 3, weight : 1.8}]
	            },
	            
	            {
	                id : 10,
	                type : 1
	            },
	            
	            {
	                id : 11,
	                type : 1
	            },
	            
	            {
	                id : 12,
	                type : 1,
	                outsources : [{id : 10, weight : 1}, {id : 11, weight : 1.8}, {id : 13, weight : 1.8}, {id : 14, weight : 1.8}, {id : 15, weight : 2.0}, {id : 16, weight : 1.5}]
	            },
	            
	            {
	                id : 13,
	                type : 1
	            },
	            
	            {
	                id : 14,
	                type : 1
	            },
	            
	            {
	                id : 15,
	                type : 1
	            },
	            
	            {
	                id : 16,
	                type : 1
	            }
	        
	        ]
	        
	    };
		
		var runningGraph = null;
		
		function graph2d(g) {
			if (runningGraph!=null)
				app.runtime.stop();
			$('body').html('');
			
			runningGraph = app.runtime.start(g);
			console.dir(runningGraph);
			
            window.addEventListener('mousewheel', function(event) {
           	 	var delta = 0;
                if (!event) /* For IE. */
                        event = window.event;
                if (event.wheelDelta) { /* IE/Opera. */
                        delta = event.wheelDelta/120;
                } else if (event.detail) { /** Mozilla case. */
                        /** In Mozilla, sign of delta is different than in IE.
                         * Also, delta is multiple of 3.
                         */
                        delta = -event.detail/3;
                }
                console.log('mousewheel', delta);
           }, false);
        	

		}
	    
		function loadEnformableTimeline(url) {
			
			var maxEvents = 256;
			
			$.getJSON(url, function(data) {
				var l = [];
				
				var minTime, maxTime;
				var ll = data.events.length;
				if (ll > maxEvents)
					ll = maxEvents;
				
				for (i = 0; i < ll; i++) {
					var e = data.events[i];
					var unixtime = Date.parse(e.start);
					e.startUnix = unixtime;
					
					if ((i == 0) || (unixtime < minTime))
						minTime = unixtime;
					if ((i == 0) || (unixtime > maxTime))
						maxTime = unixtime;					
				}
				
				
				
				for (i = 0; i < ll; i++) {
					var e = data.events[i];

					var t = 5 * ((e.startUnix - minTime) / (maxTime - minTime) - 0.5);
					
					var maxLength = 32;
					if (e.title.length > maxLength)
						e.title = e.title.substring(0, maxLength);
					
					var x = {
						id: e.start,
						label: e.title,
						type:1, 
						fixedX:t
					};
					
					l.push(x);
				}
				
				graph2d(l);
			});
			
		}
		
		$(document).ready(function() {
			//graph2d(g.companies);	
			loadEnformableTimeline('/schema/enformable-fukushima-timeline.json');
		});
		
		</script>
	</head>
		
	<body>
	    <div class="no-msie message" style="display:none">
	        <h1>This demo only works on</h1>
	        <a href="http://www.apple.com/safari/" class="safari">Safari 4+</a>
	        <a href="http://www.firefox.com" class="firefox">Firefox 3+</a>
	        <a href="http://www.google.com/chrome" class="chrome">Chrome</a>
	        <p class="explorer">I did not take the effort to make the demo work on Internet Explorer. Making it work
            for Internet Explorer will require HTML5 canvas emulation, and browser specific
            performance optimizing.</p>
	    </div>
	</body>
</html>