<html>
    <head>
        <script src="/socket.io/socket.io.js"></script>
        
        <!-- openlayers -->
        <script src="http://www.openlayers.org/api/OpenLayers.js"></script>

        <!-- google maps -->
        <script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>

        <!-- mktree -->
        <script src="mktree/mktree.js"></script>
        <link type="text/css" rel="stylesheet" href="mktree/mktree.css"/>
        
        <!-- jQuery and jQuery-UI -->
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.23/themes/base/jquery-ui.css" type="text/css" media="all" />
	<link rel="stylesheet" href="http://static.jquery.com/ui/css/demo-docs-theme/ui.theme.css" type="text/css" media="all" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
        <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.min.js" type="text/javascript"></script>                        
        
        <script src="/jquery-tmpl/jquery.tmpl.js"></script> <!-- <script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script> -->
        <script src="/jstorage/jstorage.js"></script>
        
        <!-- Superfish -->
        <script type="text/javascript" src="/superfish/js/superfish.js"></script>
        <link rel="stylesheet" media="screen" href="/superfish/css/superfish.css">
        <link rel="stylesheet" media="screen" href="/superfish/css/superfish-navbar.css">
        <link rel="stylesheet" media="screen" href="/superfish/css/superfish-vertical.css">

        <script src="map.js"></script>
        <script src="map.heatmap.js"></script>
        <script src="sensor.js"></script>
        <script src="environment.js"></script>
        <script src="self.js"></script>
        <script src="team.js"></script>
        
	<link rel="stylesheet" href="map.css" type="text/css" media="all" />
	<link rel="stylesheet" href="team.css" type="text/css" media="all" />
	<link rel="stylesheet" href="environment.css" type="text/css" media="all" />
                
        <title>Global Survival System - Map</title>
        
        <script>
            var heatMapDetailLevel = 4;
            var activeIndicators = [];
            var nextCategoryID = 0, nextNewsID = 0, nextControlID = 0;
            
            var sensors = { };
            var sensorImportance = { };
            var sensorClient = { };
            
            var layers = [];
            
            var socket = io.connect('http://localhost:8080');
            
            
            //var etherpadBaseURL = 'http://localhost:9001';
            var Self = $.jStorage;

            function showHelp() {
                $('#help').html('<center>Loading...</center>');
                $("#help").dialog({
			height: 650,
                        width: '90%',
                        zIndex: 5000,
                        title: 'Help',
			modal: true
		});
                $('#help').load('help.html');
            }
            
            
            function applyTemplate(template, params, target) {
                $( template ).tmpl( params).appendTo( target );                          
            }
            
            function templatize(template, params) {
                return $( template ).tmpl( params);
            }
            
             
            function initPresets() {
                
                applyTemplate("#presetTemplate", [
                    
                    { name: "1st World Civilization", desc: "The amenities and benefits of the world's most advanced societies." },                            
                    { name: "Camping", desc: "Camping in nature, away from civilization." },                            
                    { name: "3rd World Civilization", desc: "Developing regions must be ready to adapt to environmental problems." },                     
                    { name: "Food", desc: "Edible and drinkable substances" },
                    { name: "Disaster", desc: "When evacuation becomes a priority, avoid disaster with a set of minimal but critical concerns." },                            
                    { name: "Wellness", desc: "Healthcare, hospital, pharmacies, etc..." }
                ], "#presetsSurvive" );    

                applyTemplate("#presetTemplate", [
                    
                    { name: "Fun", desc: "Entertainment and enjoyment" },           
                    { name: "Explore", desc: "Discover something new" },           
                    { name: "Adventure", desc: "Adventure, quest, or surprising opportunity" },
                    { name: "Learn", desc: "Educational resources" },
                    { name: "Relax", desc: "Chill out, do nothing, sleep" }
                ], "#presetsGrow" );
                
                applyTemplate("#presetTemplate", [
                    
                    { name: "Paid Labor", desc: "Work and jobs that pay" },           
                    { name: "Volunteer", desc: "Opportunities to contribute" },           
                    { name: "Rescue", desc: "Help, liberate, or assist those in need or distress" },
                    { name: "Meet", desc: "Meet new people" }

                ], "#presetsShare" );
                
                $(document).ready(function() { 
                    $('#presetsMenu').superfish(); 
                }); 
 
            }
            
            
            function removeMapLayers() {
                for (i = 0; i < layers.length; i++) {
                    theMap.removeLayer(layers[i]);
                }
                layers = [];
            }            
            
            function addMapLayer(l) {
                layers.push(l);
                theMap.addLayer(l);
            }
            
            var heatmapOpacity = 0;
            function updateHeatmapOpacity(o) { 
                heatmapOpacity = o;
                if (o == 0) {
                    $('#mapHeat').hide();
                }
                else {
                    $('#mapHeat').show();                    
                }
                $('#mapHeat').css('opacity', o/100.0); 
            }
            
            function updateHeatmapDetail(d) {
                heatMapDetailLevel = d;
                update();
            }
            
            
            
            $(document).ready(function(){
		var tabs = $( "#tabs" ).tabs({
                    selected: 0
                });


                initPresets();
             
                initMap(function() {
                    update();
                });

                updateLocation();

                addSuggestions();
                
                socket.on('receive', function (message) {
                    addMessage(message);
                    //$("#messages").append("<br>"+name+": "+message);
                   //socket.emit('my other event', { my: 'data' });
                });
                
                loadSelf();
                
                initSensors();
                
                
            });
        </script>
        
        <script id="presetTemplate" type="text/x-jquery-tmpl">
            <li>
                <a href="javascript:enablePreset('${name}');">
                    <p><b>${name}</b></p>
                    <p>${desc}</p>
                </a>
            </li>
        </script>
        
        <script id="productSuggestionTemplate" type="text/x-jquery-tmpl">            
            May need: <a href="${link}">${name}</a><br/>
            <div style="float: left; width: 40%"><img src="${imageURL}"/></div>
            <div style="float: right; width: 55%"><p><b>${price}</b> ${reason}</p></div>
            <div style="clear:both"></div>
        </script>
        
    </head>


    <body>
        <div id="controls"> 
            

                                    
                    <div id="tabSensors">

                        <div class="table">
                            <ul id="presetsMenu" class="sf-menu sf-js-enabled sf-shadow">
                                <li>
                                    <a href="#a">[-]</a>
                                    <ul>
                                        <li><a href="">Reset</a></li>
                                        <li><a href="javascript:expandTree('tree1');">Expand All</a></li>
                                        <li><a href="javascript:collapseTree('tree1');">Collapse All</a></li>
                                        <li><a href="javascript:requestUserSupport('Saving the current sensors to a preset')">Save</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="#">Survive</a>
                                    <ul id="presetsSurvive"></ul>
                                </li>
                                <li>
                                    <a href="#">Evolve</a>
                                    <ul id="presetsGrow"></ul>
                                </li>
                                <li>
                                    <a href="#">Share</a>
                                    <ul id="presetsShare"></ul>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Interests -->
                        <ul class="mktree" id="tree1" style="clear: both">
                            
                            <!-- <A class="button" href="#" onClick="expandToItem('tree1','login'); return false;">Expand to a certain location</A> -->
                        </ul>

                        
                        <p>
                            Heatmap Transparency: <input type="range" value="0" min="0" max="100" onchange="updateHeatmapOpacity(this.value)"/>
                        </p>
                        <p>
                            Heatmap Detail: <input type="range"  min="2" max="32" step="1" onchange="updateHeatmapDetail(this.value)"/>
                        </p>

                    </div>
                   
                
                
                
            </div>
            
        

        <div id="status">
            <div id="tabs">
                    <ul>
                        <li><a href="#tabTeam">Team</a></li>
                        
                        <li><a href="#tabEnvironment">Environment</a></li>

                        <li><a href="#tabSelf">Self</a></li>
                        
                        <li><button onClick="showHelp()">Help</button></li>
                    </ul>

                <div id="tabEnvironment">
                    <div id="statusHeader"></div>
                    <div id="statusContent">
                        <div id="statusSensors"></div>                    
                    </div>            
                </div>
                
                <div id="tabTeam">
                    
                    <div id="teamWrapper">

                        <div id="teamRoster">
                            Roster
                        </div>

                        <div id="teamContent">
                        </div>

                        <div id="teamInput">
                            <input type='text' id="text-input"/>
                            <input type='submit' id="send-button" onclick="send()" value="send"/>
                        </div>
                        
                    </div>

                </div>
                
                <div id="tabSelf">
                    Name: <input id="selfName" type="text" size="24"/><br/>
                    Biography: <textarea id="selfBiography" cols="24" rows="3"></textarea>
                    <button onclick="saveSelf()">Save</button>
                </div>
                
            </div>
            
        </div>        
        <div id="map">
            <canvas id="mapHeat"></canvas>            
        </div>
        
        
        <div id="edit"  style="display: none; z-index: 5000">
        </div>
        
        <div id="help"  style="display: none; z-index: 5000"></div>
        
        <div id="userSupport"  style="display: none; z-index: 5000">
            <i>The following feature is not complete yet:</i><br/><br/>
            <div id="userSupportMessage"></div><br/>
            <hr/><br/>
            <center>
                To accelerate this, please support the development of this software:<br/><br/>
                <img src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" alt="PayPal - The safer, easier way to pay online!"> <img src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" alt="" width="1" height="1" border="0"/>
            </center>
        </div>

    </body>
</html>
