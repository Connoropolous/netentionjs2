<html>
    <head>
    
        <script src="/lib/jquery/jquery.js"></script>
        <script src="netention.js"></script> 
        
        <script>
        
            
            
            function renderFeatureHeading(l) {
                return '<div class="FeatureHeading">' + l + '</div>';
            }
            function renderFeatureCell(v) {
                var g = 255;
                var r = parseInt((1.0-v)*255.0);
                var b = parseInt((1.0-v)*255.0);
                var bg = 'rgb(' + r + ',' + g + ',' + b +')';
                return '<div class="featureCell" style="background-color: ' + bg + '">' + v + '</div>';
            }
            
            function renderHistogram(x) {
                var d = $('<div></div>');
                d.append('<h2>' + x.id + '</h2>');
                d.append(new Date(x.tStart) + ' <i>to</i> ' + new Date(x.tStop));
                _.each(x.features, function(v, k) {
                    var f = $('<div></div>');
                    f.append(renderFeatureHeading(k));
                    for (var i = 0; i < x.tSteps; i++) {
                        f.append(renderFeatureCell(v[i]));
                    }
                    f.append('<br/>');            
                    
                    d.append(f);                    
                });
                d.append('<h3>Conclusions</h3><ul>');
                _.each(x.conclusions, function(c) {
                    d.append('<li>' + c + '</li>');
                });
                d.append('</ul>');
                
                d.append('<h3>Suggestions</h3><ul>');
                _.each(x.suggestions, function(c) {
                    d.append('<li>' + c + '</li>');                    
                });
                d.append('</ul>');
                
                return d;
            }
            
            $(document).ready(function(){
                netention(function(self) {
                    $.getJSON('/histogram', function(r) {                    
                        $('body').append(renderHistogram(r));
                    });
                });
            });
        </script>
        <style>
            body {
                font-family: arial, sans;
            }
            .FeatureHeading {
                width: 8em;
                float: left;
            }
            .featureCell {
                width: 4em;
                float: left;
                text-align: center;
            }
        </style>
    </head>    
    
    <body>
        <h1>Noosphere Analysis</h1>
    </body>
</html>