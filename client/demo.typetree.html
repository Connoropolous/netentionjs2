<!DOCTYPE html>
<html>
    <head>
        <title>TypeTree Demo | Netention</title>
        
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="netention.js"></script> 
        
        <script>
        
            function updateTypeTree(a) {
                var self = window.self;
                
                a.html('');    
                var dt = $('<div></div>');
                var tree = $('<ul></ul>').css('display','none');
                                
                function subtree(root, i) {
                    var name = i.name + ' (' + i.uri + ')';
                    var xi = 'tagtree_' + i.uri;
                    var n = $('<li id="' + xi + '"><!--<input type="checkbox"/>-->' + name + '</li>');
                    root.append(n);
                    
                    var children = self.subtags(i.uri);
                    
                    if (children.length > 0) {
                        n.addClass('folder');
                        var nu = $('<ul></ul>');
                        n.append(nu);
                        _.each(children, function(c) {
                            subtree(nu, self.tag(c));
                        });                            
                    }
                }
                
                var roots = self.tagRoots();
                _.each(roots, function(t) {
                   subtree(tree, self.tag(t));
                });
                
                               
                tree.appendTo(dt);
                dt.appendTo(a);
                
                dt.dynatree({
                    checkbox: true,
                    selectMode: 2, // 1:single, 2:multi, 3:multi-hier
                    onActivate: function(node) {
                        //alert("You activated " + node);
                    }
                });
                
            }
            
            $(document).ready(function(){
                netention(function(self) {
                    
                    window.self = self;
                    
                    updateTypeTree($('#Content'));
                    self.on('change:tags', function() {
                       updateTypeTree($('#Content')); 
                    });
                });
            });
            
        </script>
        <style>
            
            #Content {
                width: 100%; 
                font-size: 180%;
            }
            #Content div li {
                padding-top: 0.17em;
                padding-bottom: 0.17em;
            }
            .ui-widget-content { border: none; }
        </style>
    </head>
    <body>
        <div id="Content">
        </div>
    </body>
</html>